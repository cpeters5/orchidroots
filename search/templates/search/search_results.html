{% load static %}
{% load static %}
{% include "base.html" %}
{% block body %}
<style>
table {
    padding: 100px;
    margin-left: auto;
    margin-right: auto;
    font-size: 14px;
}
td {
    /*border: 1px solid lightgrey;*/
    padding: 10px;
}
.thumbnails {
    object-fit: cover;
    overflow: hidden;
    height: 70px;
    width : 70px;
    margin:5px auto;
}

.column-3 {
    display: table-cell;
}
.column-2 {
    display: none;
}


@media only screen and (max-width: 600px) {
    table {
        width: 100%;
        font-size:12px;
    }
    .thumbnails {
       height: 80px;
       margin:5px auto;
    }
    td {
        border: 1px solid lightgrey;
        padding-left: 10px;
    }
    .column-3 {
        display: none;
    }
    .column-2 {
        display: table-cell;
    }

}
</style>
<div style="min-height:200px;margin: 0 auto;width: 90%;">
    <div>
        <form class="form-inline" id="displaysearch" action="/search/search/{{app}}/" style="margin-top: 5px;">
            <input type="hidden" form="displaysearch" name="role" value="{{ role }}">

            <input class="searchbox" form="displaysearch" value="{{search_string}}"
                   type="text" name="search_string"
                   placeholder="Search scientific name" title="The search string must be at least 3 characters long"
                   style="border: 1px solid #ccc; border-right: 0; padding: 8px 12px; width: 300px; border-radius: 4px 0 0 4px;margin:0 auto">

            <button form="displaysearch" type="submit" style="display:none;"></button>
        </form>
    </div>
    <br>
    <div style="text-align: center;">
        <h5>
            {% if search_string %}
                Scientific name in teh {{app|title}} domain matching "{{search_string}}"
            {% else %}
                Please submit a scientific name (genus species) to search in the {{app|title}} domain
            {% endif %}
        </h5>
        To search for common name, try
            <a class="btn btn-primary" href="{% url 'search:search_name' app %}?role={{role}}&search_string={{search_string}}">Search by commonname</a>
    </div>

    <div class="container m-2"  style="width:100%; display:inline-block; padding-top:0;">
    {% if matched_genus %}
        <table class="table table-condensed  table-hover" style="padding-bottom: 0px; width: 85%;">
            <thead>
                <th>Genus</th>
            </thead>
            <tr>
                {% for match in matched_genus %}
                <td>
                    {% if not match.type == 'species' %}
                        <a href="{% url 'common:species' %}?app={{match.family.application}}&role={{role}}&family=Orchidaceae&genus={{match}}"><i>{{match}}</i></a> {{matched_genus.author|default:''}} {{matched_genus.year|default:''}}
                        {% if matched_genus.status == 'synonym' %}<br>(syn.){% endif %}
                    {% else %}
                         <a href="{% url 'common:species' %}?app={{match.family.application}}&role={{role}}&family=Orchidaceae&genus={{match}}"><i>{{match.genus}}</i></a>  {{matched_genus.author|default:''}} {% if matched_genus.status == 'synonym' %}(syn.){% endif %}
                    {% endif %}
                    {% if user.tier.tier > 3 %}
                    {{match.pid|default:''}}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
        </table>
    {% endif %}

    {% if matched_species or found_species or exact_match %}
        <table class="table-bordered table-condensed table-sm table-hover border" id="sortTable" style="font-size: 14px; width: 100%">
            <thead>
                <tr>
                    <th style="width:20%;">Sample image</th>
                    <th style="width:40%; text-align: left;"><b>Species</b></th>
                    <th style="width:40%; text-align: left;"><b></b></th>
                </tr>
            </thead>
            {% if exact_match %}
                {% for species in exact_match %}
                    <tr>
                        <td>{% if species.get_best_img %}
                            <img class="thumbnails" alt="{{species.get_best_img}}" src="{% static species.get_best_img.thumb_dir %}{{species.get_best_img.image_file}}">
                            {% endif %}
                        </td>
                        <td style="width:20%;">
                            <a href="{% url 'display:summary' species.family.application species.pid %}?family={{species.family|default:'Orchidaceae'}}&role={{role}}">
                                {{species.binomial}}</a>  {{species.author|default:''}} {{species.year|default:''}}
                        </td>
                        <td class="column-2" style="width:10%;">
                            {% if species.status == 'synonym' %}
                                Synonym
                            {% elif species.type == 'hybrid' %}
                                hybrid
                            {% else %}
                                accepted
                            {% endif %}
                        </td>
                        <td class="column-3" style="width:10%;">
                            {% if species.status == 'synonym' %} syn.
                                {% if species.getAcc %}
                                    <a href="{% url 'display:summary' species.family.application species.getAcc %}?family={{species.family|default:'Orchidaceae'}}&role={{role}}">
                                        {{species.getAccepted.binomial}}
                                    </a>
                                {% else %}
                                    {{species.getAccepted.binomial}} (syn)
                                {% endif %}
                            {% elif species.type == 'hybrid' %}
                                {{species.hybrid.seed_id.name|safe}} x {{species.hybrid.pollen_id.name|safe}}
                            {% else %}
                                accepted species
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
<!--                <tr style="background-color: #918f8f"><td></td></tr>-->
            {% endif %}
            {% if found_species %}
                {% for species in found_species %}
                    <tr>
                        <td>{% if species.get_best_img %}
                            <img class="thumbnails" alt="{{species.get_best_img}}" src="{% static species.get_best_img.thumb_dir %}{{species.get_best_img.image_file}}">
                            {% endif %}
                        </td>
                        <td style="width:20%;">
                            <a href="{% url 'display:summary' species.family.application species.pid %}?family={{species.family|default:'Orchidaceae'}}&role={{role}}">
                                {{species.binomial}}</a>  {{species.author|default:''}} {{species.year|default:''}}
                        </td>
                        <td style="width:10%;">
                            {% if species.status == 'synonym' %} syn.
                                {% if species.getAcc %}
                                    <a href="{% url 'display:summary' species.family.application species.getAcc %}?family={{species.family|default:'Orchidaceae'}}&role={{role}}">
                                        {{species.getAccepted.binomial}}
                                    </a>
                                {% else %}
                                    {{species.getAccepted.binomial}} (syn)
                                {% endif %}
                            {% elif species.type == 'hybrid' %}  {{species.hybrid.seed_id.name|safe}} x {{species.hybrid.pollen_id.name|safe}}
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
<!--                <tr style="background-color: #918f8f"><td></td></tr>-->
            {% endif %}
            {% if matched_species %}
                {% for species in matched_species %}
                    <tr>
                        <td>{% if species.get_best_img %}
                            <img class="thumbnails" alt="{{species.get_best_img}}" src="{% static species.get_best_img.thumb_dir %}{{species.get_best_img.image_file}}">
                            {% endif %}
                        </td>
                        <td style="width:20%;">
                            <a href="{% url 'display:summary' species.family.application species.pid %}?family={{species.family|default:'Orchidaceae'}}&role={{role}}">
                                {{species.binomial}}</a>  {{species.author|default:''}} {{species.year|default:''}}
                        </td>
                        <td style="width:10%;">
                            {% if species.status == 'synonym' %} syn.
                                {% if species.getAcc %}
                                    <a href="{% url 'display:summary' species.family.application species.getAcc %}?family={{species.family|default:'Orchidaceae'}}&role={{role}}">
                                        {{species.getAccepted.binomial}}
                                    </a>
                                {% else %}
                                    {{species.getAccepted.binomial}} (syn)
                                {% endif %}
                            {% elif species.type == 'hybrid' %}  {{species.hybrid.seed_id.name|safe}} x {{species.hybrid.pollen_id.name|safe}}
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% endif %}
        </table>
    {% endif %}
    </div>
</div>


{% include "base-datatable.html" %}

<script>

$(document).ready(function(){
    $('a[data-toggle="tab"]').on('show.bs.tab', function(e) {
        localStorage.setItem('activeTab', $(e.target).attr('href'));
    });
    var activeTab = localStorage.getItem('activeTab');
    if(activeTab){
        $('#myTab a[href="' + activeTab + '"]').tab('show');
    }
});

$(document).on('click', '[data-toggle="lightbox"]', function(event) {
                event.preventDefault();
                $(this).ekkoLightbox();
            });

$(document).ready(function(){
  $('[data-toggle="tooltip"]').tooltip();
});

    function handleSelect(select) {
      var selectedOption = select.value;
      console.log("Selected option:", selectedOption);
      // Perform further actions based on the selected option
      // e.g., submit the form programmatically, redirect, etc.
      select.form.submit();
    }


document.getElementById('search').addEventListener('submit', function(event) {
    var input = document.getElementById('your-input-id').value;
    if (!/^[\u0000-\u007F]*$/.test(input)) {
        event.preventDefault();
        alert('Please use only supported characters.');
    }
});



$(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip();
    var initialFilterValue = "{{ spc | default:'' | escapejs }}";
    var table = $('#sortTable').DataTable({
        "info": true,
        "paging": true,  // Enable paging
        "lengthChange": false,
        "pageLength": 50,
        "lengthMenu": [[50,100,150,200,250,300,-1], [50,100,150,200,250,300,"All"]],
        "colReorder": true,
        "columnDefs": [
            { "type": "priority", "targets": 1 },
            // { targets: [5, 6, 7], className: 'none' }
        ],
        "order": [[0,'asc'],],
        responsive: true,
        "dom": "<'row'<'col-sm-6'f><'col-sm-6'p>>" +  // Top pagination
               "<'row'<'col-sm-12'tr>>" +
               "<'row'<'col-sm-5'i><'col-sm-7'p>>",  // Bottom pagination

        language: {
            search: "_INPUT_",
            "sProcessing": "Processing...",
            "sZeroRecords": "No match results",
        },
        "drawCallback": function(settings) {
            var api = this.api();
            var pageInfo = api.page.info();

            // Show/hide info and pagination
            $('.dataTables_info, .dataTables_paginate').toggle(pageInfo.pages > 1);

            // Adjust the filter and top pagination position
            if (pageInfo.pages <= 1) {
                $('.dataTables_filter').css({
                    'float': 'left',
                    'margin-bottom': '10px'
                });
                $('.dataTables_paginate:eq(0)').hide();  // Hide top pagination if only one page
            } else {
                $('.dataTables_filter').css({
                    'float': 'left',
                    'margin-bottom': '0'
                });
                $('.dataTables_paginate:eq(0)').show().css('float', 'right');  // Show top pagination
            }

            // Log info for debugging
            console.log("Total pages:", pageInfo.pages);
            console.log("Current page:", pageInfo.page);
            console.log("Total records:", pageInfo.recordsTotal);
        },

        "initComplete": function(settings, json) {
            $('.dataTables_filter input').attr('placeholder', 'Filter results');
        }
    });

    // Set initial filter value and draw table
    $('.dataTables_filter input').val(initialFilterValue);
    table.search(initialFilterValue).draw();
});

</script>



{% endblock %}
