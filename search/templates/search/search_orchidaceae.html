{% load static %}
{% include "base.html" %}
{% block body %}
{% load testtags %}

<style>
table {
      padding-top: 2px;
      padding-right: 10px;
      padding-bottom: 0;
      padding-left: 10px;
      margin-left: auto;
      margin-right: auto;
      width: 80%;
}
td {
    /*border: 1px solid lightgrey;*/
    padding: 10px;
}

.thumbnails {
   object-fit: cover;
   overflow: hidden;
   height: 70px;
   width : 70px;
   margin:5px auto;
}

@media only screen and (max-width: 600px) {
    table {
      padding-top: 2px;
      padding-right: 0;
      padding-bottom: 5px;
      padding-left: 0;
      margin-left: 0;
      margin-right: 0;
      font-size:12px;
    }
    .thumbnails {
       height: 50px;
       margin:5px auto;
    }
    td {
        min-width: 50px;
        min-height: 50px;
    }
}
.dataTables_wrapper .row {
    width: 90%;
    margin: 0 auto; /* Center the row if necessary */
}
.dataTables_wrapper .dataTables_info {
    padding-bottom: 5px;  /* Adds padding below the table info and above pagination controls */
    text-align: center;
    float: none;
    clear: both;
    margin: 10px auto; /* Add some margin for better spacing */
}
.dataTables_wrapper .dataTables_paginate .paginate_button {
    text-align: center;
    float: none;
    clear: both;
    padding: 2px 8px; /* Increase padding to make buttons larger */
    font-size: 14px; /* Adjust font size as needed */
    line-height: 1.5; /* Adjust line height for better vertical alignment */
}

/* You might also want to adjust the hover and active states */
.dataTables_wrapper .dataTables_paginate .paginate_button:hover {
    background-color: #f0f0f0; /* Example hover background color */
}

.dataTables_wrapper .dataTables_paginate .paginate_button:active {
    box-shadow: inset 0 0 3px #666; /* Example active state shadow */
    text-align: center;
    float: none; /* Override default floating */
}
.no-border-bg {
    background: none !important;
    border: none !important;
}

.dataTables_filter label {
    font-size: 14px; /* Adjust the size as needed */
}

</style>
<div style="min-height:200px;background-color:#f4f6f3;width: 100%;text-align: left;">
    <div style="text-align: center;">
        <br>
        <h5 class="card-title" style="margin-bottom: 0">Search results for  "<i>{{search_string}}</i>"</h5>
        <div id="accordion">
            <div class="card mt-1 no-border-bg">
                <div class="card-header no-border-bg">
                    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#Help">
                        <h6 class="card-title" style="margin-bottom: 0"><b>HELP</b></h6>
                    </button>
                </div>
                <div id="Help" class="collapse" data-parent="#accordion">
                    <div class="card-body">
                        If your search did not return the orchid you were looking for, consider exploring one of the following alternatives to improve your results:
                        <ul style="font-size: 16px; list-style-type: disc; text-align: left; width: 70%; margin-left: 50px; margin-top: 20px;">
                            <li>Make sure to include the genus name in your search term. This will help refine your search and yield more precise results. </li>
                            <li>Check the genus and/or species spelling in your search term and recommit the search.</li>
                            <li>Consider including an approximate species name in your search term to help find similar matches.</li>
                            <li>Click on the matched genus in the "Genus" section to view the complete list of species within that genus.</li>
                            <li> The search term may contain common name of the plant.
                                Use the 'common_name search' option on the navbar to search for the species part of your search term, (do not include genus).
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    <table class="table table-condensed  table-hover" style="padding-bottom: 0px; width: 85%;">
    {% if matched_genus %}
        <tr>
            <td>
                {% if not matched_genus.num_hybrid or matched_genus.num_species > 0 %}
                    <a href="{% url 'orchidaceae:species' %}?family={{matched_genus.family|default:'Orchidaceae'}}&genus={{matched_genus.genus}}"><i>{{matched_genus}}</i></a> {{matched_genus.author|default:''}} {{matched_genus.year|default:''}}
                    {% if matched_genus.status == 'synonym' %}<br>(syn.){% endif %}
                {% else %}
                     <a href="/orchidaceae/hybrid/?family={{matched_genus.family|default:'Orchidaceae'}}&genus={{genus.0.genus}}"><i>{{matched_genus.genus}}</i></a>  {{matched_genus.author|default:''}} {% if matched_genus.status == 'synonym' %}(syn.){% endif %}
                {% endif %}
                {% if user.tier.tier > 3 %}
                {{matched_genus.pid|default:''}}
                {% endif %}
            </td>
        </tr>

    {% elif genus_list %}
        <tr>
            <th>Genus not found. Could there be a typo in the name? Here are some closely matched genera:</th>
            <th></th>
        </tr>
        {% for genus in genus_list %}
            <tr style="background-color: white;">
                <td>
                    {% if not genus.num_hybrid or genus.num_species > 0 %}
                        <a href="/common/species/?family={{genus.family|default:'Orchidaceae'}}&genus={{genus.genus}}"><i>{{genus}}</i></a> {{genus.author|default:''}} {{genus.year|default:''}}
                        {% if genus.status == 'synonym' %}<br>(syn.){% endif %}
                    {% else %}
                        {% if genus.family.family == 'Orchidaceae' %}
                            <a href="/orchidaceae/hybrid/?family={{genus.family|default:'Orchidaceae'}}&genus={{genus.genus}}"><i>{{genus.genus}}</i></a>  {{genus.author|default:''}} {% if genus.status == 'synonym' %}(syn.){% endif %}
                        {% else %}
                            <a href="/common/hybrid/?family={{genus.family|default:'Orchidaceae'}}&genus={{genus.genus}}"><i>{{genus}}</i></a>  {{genus.author|default:''}} {% if genus.status == 'synonym' %}(syn.){% endif %}
                        {% endif %}
                    {% endif %}
                {% if user.tier.tier > 3 %}
                <br>{{genus.pid|default:''}}
                {% endif %}
                </td>
                <td style="min-width:100px; text-align: center">
                    {% if genus.get_best_img %}
                     <img class="thumbnails" alt="{{genus.genus}}" src="{% static genus.img.thumb_dir %}{{genus.img.image_file}}">
<!--                                {{genus.0.get_best_img.pid.name|safe}}-->
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    {% endif %}
    </table>
    {% if match_spc_list %}
        <table id="sortTable" class="table table-condensed table-sm table-hover" style="font-size: 13px; width: 100%" >
            <thead>
                <tr style="text-align: left; border-bottom:none">
                    <th class="spc_column">Species</th>
                    <th class="d-none d-lg-table-cell" style="text-align: center">Sample images</th>
                </tr>
            </thead>
        {% for species in match_spc_list %}
            <tr style="background-color: white;">
                <td style="text-align: left; border-bottom:none">
                    <a href="/display/{{path}}/{{species.pid}}/?family={{species.family|default:'Orchidaceae'}}&role={{role}}&related=ALL&syn=Y&searchdata={{searchdata}}">
                        <i>{{species.binomial|safe}}</i>
                    </a>
                    {{species.author|default:''}} {{species.year|default:''}}
                    {% if species.status == 'synonym' %}<br>(syn. {{species.getAccepted.binomial_it|safe}}){% endif %}
                    {% if user.tier.tier > 3 %}
                        <br>{{species.pid}}-{{species.getAccepted.pid}} score = {{species.score}}
                    {% endif %}
                </td>
                <td style="text-align: center; border-bottom:0">
                    {% if species.get_best_img %}
                     <img class="thumbnails" alt="{{species.name|safe}}" src="{% static species.get_best_img.thumb_dir %}{{species.get_best_img.image_file}}">
                    {% endif %}
                </td>
            </tr>
        {% endfor %}

    {% else %}
        <tr><td></td><td></td></tr>
    {% endif %}
    {% if other_genus_spc %}
        {% for species in other_genus_spc %}
            <tr style="background-color: white;">
                <td style="min-width:100px; text-align: center">
                    {% if species.get_best_img %}
                     <img class="thumbnails" alt="{{species.name|safe}}" src="{% static species.get_best_img.thumb_dir %}{{species.get_best_img.image_file}}">
                    {% endif %}
                </td>
                <td>
                    <a href="/display/{{path}}/{{species.pid}}/?family={{species.family|default:'Orchidaceae'}}&role={{role}}&related=ALL&syn=Y&searchdata={{searchdata}}">
                        <i>{{species.binomial|safe}}</i>
                    </a>
                    {{species.author|default:''}} {{species.year|default:''}} {% if species.status == 'synonym' %}(syn. {{species.getAccepted.binomial_it|safe}}){% endif %}
                        (<i>{{species.family|default:''}}</i>
                        {% if species.family.application == 'other' or species.family.application == 'orchidaceae' %}Plantae{% else %}{{species.family.application}}{% endif %})
                </td>
                <td>{{species.accepted.common_name|default:''}}</td>
                <td>{{species.distribution|default:''}}</td>
                {% if user.tier.tier > 3 %}
                <td class="d-none d-lg-table-cell hidden-xs" style="text-align: center;">{{species.num_image|default:''}}</td>
                {% endif %}
            </tr>
        {% endfor %}

    {% endif %}
    </table>
</div>
</div>
</div>

<script>
    $(document).ready(function () {
        $('a[data-toggle="tab"]').on('show.bs.tab', function (e) {
            localStorage.setItem('activeTab', $(e.target).attr('href'));
        });
        var activeTab = localStorage.getItem('activeTab');
        if (activeTab) {
            $('#myTab a[href="' + activeTab + '"]').tab('show');
        }
    });

    $(document).ready(function() {
        var dataTable = $('#sortTable').dataTable({
        "pageLength": 25,
        "drawCallback": function(settings) {
            var api = this.api();
            var rows = api.rows({page: 'current'}).nodes();
            var lastRow = api.row(rows.length - 1, {page: 'current'}).index();
            var totalRecords = api.page.info().recordsDisplay;

            // Check if the total records are less than the page length
            if (totalRecords <= api.page.len()) {
                $('.dataTables_paginate').hide(); // Hide pagination
                $('.dataTables_filter').hide();   // Hide search box
            } else {
                $('.dataTables_paginate').show(); // Show pagination
                $('.dataTables_filter').show();   // Show search box
            }
        },
        "info": false,
        "pagingType": "full",
        "order": [],
        "aLengthMenu": [[50,100,150,200,250,300,-1], [50,100,150,200,250,300,"All"]],
        "lengthChange": false,
        "bPaginate": true,
        "pagingType": "simple_numbers",
        "fnPreDrawCallback": function( oSettings ) {
        $('.dataTables_filter input').attr({'name':'','placeholder': 'search'});//tips
    },
        // "dom": '<"top"i>rt<"bottom"flp><"clear">',
        // "dom": '<"top"flp>rt<"bottom"i><"clear">',
        // "dom": '<"wrapper"flipt>',
        // "dom": "<'row'<'col-md-6'l><'col-md-6'Bf>>" + "<'row'<'col-md-6'><'col-md-6'>>" + "<'row'<'col-md-12't>><'row'<'col-md-12'ip>>",
        // "dom": "<'row'<'col-sm-12'tr>>" + "<'row'<'col-sm-4'f><'col-sm-8'p>>",
        // "dom": "<'row'<'col-sm-4'f><'col-sm-8'p>>" + "<'row'<'col-sm-12'tr>>",
        "dom": "<'row'<'col-sm-4'f><'col-sm-4'i><'col-sm-4'p>>" + "<'row'<'col-sm-12'tr>>",
        // "sDom": '<"top"flp>rt<"bottom"ip><"clear">',
        language: {
        search: "_INPUT_",
        "sProcessing": "Processing...",
        "sZeroRecords": "No match results",
        // "sSearch": "Searching:",
        // searchPlaceholder: "Search this page"
    }
    });
    });
</script>


{% endblock %}
